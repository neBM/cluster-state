{
  "ID": "media-centre",
  "Name": "Media Centre",
  "TaskGroups": [
    {
      "Name": "Media Servers",
      "Tasks": [
        {
          "Name": "Jellyfin",
          "Driver": "docker",
          "Config": {
            "image": "lscr.io/linuxserver/jellyfin:latest",
            "runtime": "nvidia",
            "ports": [
              "jellyfin"
            ],
            "mounts": [
              {
                "type": "volume",
                "target": "/media",
                "volume_options": {
                  "driver_config": {
                    "name": "local",
                    "options": [
                      {
                        "type": "nfs",
                        "o": "addr=martinibar.lan,nolock,soft,rw",
                        "device": ":/volume1/docker"
                      }
                    ]
                  }
                }
              },
              {
                "type": "volume",
                "target": "/config",
                "source": "jellyfin-config"
              }
            ]
          },
          "Artifacts": [
            {
              "Source": "https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp",
              "Destination": "/usr/local/bin/yt-dlp",
              "Mode": "file"
            }
          ],
          "Env": {
            "TZ": "Europe/London",
            "PUID": "985",
            "PGID": "997",
            "JELLYFIN_PublishedServerUrl": "192.168.1.5"
          },
          "Resources": {
            "CPU": 1200,
            "MemoryMB": 4096,
            "Devices": [
              {
                "Name": "nvidia/gpu",
                "Count": 1
              }
            ]
          }
        }
      ],
      "Services": [
        {
          "Name": "Jellyfin",
          "Provider": "nomad",
          "PortLabel": "jellyfin",
          "Tags": [
            "traefik.enable=true",
            "traefik.http.routers.jellyfin.entrypoints=websecure",
            "traefik.http.routers.jellyfin.rule=Host(`jellyfin.brmartin.co.uk`)"
          ]

        }
      ],
      "Networks": [
        {
          "DynamicPorts": [
            {
              "Label": "jellyfin",
              "To": 8096
            }
          ]
        }
      ]
    }
  ]
}